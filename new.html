<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">

    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/new.css">

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="js/mustache.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/new.templates.js"></script>

    <script type="text/javascript" src="js/CombatModules.js"></script>
    <script type="text/javascript" src="js/Elan.js"></script>
    <script type="text/javascript" src="js/Equipment.js"></script>
    <script type="text/javascript" src="js/Psychic.js"></script>
    <script type="text/javascript" src="js/Ability.js"></script>
    <script type="text/javascript" src="js/Class.js"></script>
    <script type="text/javascript" src="js/Characteristic.js"></script>
    <script type="text/javascript" src="js/Advantages.js"></script>
    <script type="text/javascript" src="js/Character.js"></script>

    <script type="text/javascript">
      $( document ).ready(function() {
        $('#classChoice').change(function(event) {
          var classKey = this.options[this.options.selectedIndex].value;
          if (classKey in Class) {
            $('#classDescription').show();
            $('#classDescription').html(Mustache.render(Template.classDescription, Class[classKey]));
          } else {
            $('#classDescription').hide();
          }
        });
        $('#classDescription').hide();
        $('#create').click(function (event) {
            var characterData = {};
            characterData.name = $('#name').val();
            characterData.exp = Number(0);
            characterData.appearance = $('#appearance').val();
            characterData.height = $('#height').val();
            characterData.weight = $('#weight').val();

            var allCharacteristicsPresent = true;
            var characteristics = {};
            characteristics.str = {'base': Number($("#strength").val())};
            allCharacteristicsPresent = allCharacteristicsPresent && characteristics.str;
            characteristics.agi = {'base': Number($("#agility").val())};
            allCharacteristicsPresent = allCharacteristicsPresent && characteristics.agi;
            characteristics.dex = {'base': Number($("#dexterity").val())};
            allCharacteristicsPresent = allCharacteristicsPresent && characteristics.dex;
            characteristics.con = {'base': Number($("#constitution").val())};
            allCharacteristicsPresent = allCharacteristicsPresent && characteristics.con;
            characteristics.int = {'base': Number($("#intelligence").val())};
            allCharacteristicsPresent = allCharacteristicsPresent && characteristics.int;
            characteristics.pow = {'base': Number($("#power").val())};
            allCharacteristicsPresent = allCharacteristicsPresent && characteristics.pow;
            characteristics.wp = {'base': Number($("#willpower").val())};
            allCharacteristicsPresent = allCharacteristicsPresent && characteristics.wp;
            characteristics.per = {'base': Number($("#perception").val())};
            allCharacteristicsPresent = allCharacteristicsPresent && characteristics.per;

            if (allCharacteristicsPresent) {
                characterData.characteristics = characteristics;
            }

            var options = $('#classChoice')[0].options;
            characterData.classId = options[options.selectedIndex].value;

            characterData.primaryAbilities = {};
            characterData.secondaryAbilities = {};
            characterData.otherAbilities = {};
            for (let i in ABILITY_DATA) {
                characterData[ABILITY_DATA[i].type+"Abilities"][i] = ABILITY_DATA[i];
                characterData[ABILITY_DATA[i].type+"Abilities"][i].dpInvested = 0;
            }

            try {
                var character = new Character(characterData);
                localStorage['character.'+character.name] = JSON.stringify(character);
                window.open("manage.html?n=" + character.name, "_self");
            } catch (error) {
                alert(error.message);
            }
            
        });
      });
    </script>

  </head>
  <body>
  <div id="content">
    <h1>New Character</h1>
    <table class="box">
      <tr>
        <td>Name: <input id="name" type="text"></td>
        <td>Appearance: <input id="appearance" type="number" min="1" max="10" value="5"></td>
        <td>Height: <input id="height" type="text"></td>
        <td>Weight: <input id="weight" type="text"></td>
      </tr>
    </table>
    <table>
      <tr>
        <td id="characteristics">
          <div class="box">
            <div class="boxTitle">Base Characteristics</div>
            <table>
              <tr class="characteristic"><td><span>Strength </span><input id="strength" type="number" min="1"></td></tr>
              <tr class="characteristic"><td><span>Agility </span><input id="agility" type="number" min="1"></td></tr>
              <tr class="characteristic"><td><span>Dexterity </span><input id="dexterity" type="number" min="1"></td></tr>
              <tr class="characteristic"><td><span>Constitution </span><input id="constitution" type="number" min="1"></td></tr>
              <tr class="characteristic"><td><span>Intelligence </span><input id="intelligence" type="number" min="1"></td></tr>
              <tr class="characteristic"><td><span>Power </span><input id="power" type="number" min="1"></td></tr>
              <tr class="characteristic"><td><span>Willpower </span><input id="willpower" type="number" min="1"></td></tr>
              <tr class="characteristic"><td><span>Perception </span><input id="perception" type="number" min="1"></td></tr>
            </table>
          </div>
        </td>
        <td class="space"></td>
        <td>
          <div class="box">
            <div class="boxTitle">Class</div>
            <select id="classChoice">
              <option value="none"></option>
              <option value="warrior">Warrior</option>
              <option value="acrobaticWarrior">Acrobatic Warrior</option>
              <option value="paladin">Paladin</option>
              <option value="darkPaladin">Dark Paladin</option>
              <option value="weaponmaster">Weaponmaster</option>
              <option value="technician">Technician</option>
              <option value="tao">Tao</option>
              <option value="ranger">Ranger</option>
              <option value="shadow">Shadow</option>
              <option value="thief">Thief</option>
              <option value="assassin">Assassin</option>
              <option value="wizard">Wizard</option>
              <option value="warlock">Warlock</option>
              <option value="illusionist">Illusionist</option>
              <option value="wizardMentalist">Wizard Mentalist</option>
              <option value="summoner">Summoner</option>
              <option value="warriorSummoner">Warrior Summoner</option>
              <option value="mentalist">Mentalist</option>
              <option value="warriorMentalist">Warrior Mentalist</option>
              <option value="freelancer">Freelancer</option>
            </select>
            <div id="classDescription"></div>
          </div>
        </td>
      </tr>
    </table>
    <div class="button" id="create">Create</div>
  </div>
  </body>
</html>